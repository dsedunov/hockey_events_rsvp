{"ast":null,"code":"var _a, _b;\nimport { __decorate, __metadata } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { FormBuilder } from '@angular/forms';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Router } from '@angular/router';\nlet RegComponent = class RegComponent {\n  constructor(router, firebaseAuth, afs, registerFormBuilder, loginFormBuilder, snackBar) {\n    this.router = router;\n    this.firebaseAuth = firebaseAuth;\n    this.afs = afs;\n    this.registerFormBuilder = registerFormBuilder;\n    this.loginFormBuilder = loginFormBuilder;\n    this.snackBar = snackBar;\n    this.stickSelected = '';\n    this.roleSelected = '';\n    this.sticks = [{\n      value: 'Левый',\n      viewValue: 'Левый'\n    }, {\n      value: 'Правый',\n      viewValue: 'Правый'\n    }];\n    this.roles = [{\n      value: 'Вратарь',\n      viewValue: 'Вратарь'\n    }, {\n      value: 'Защитник',\n      viewValue: 'Защитник'\n    }, {\n      value: 'Нападающий',\n      viewValue: 'Нападающий'\n    }];\n    this.loginForm = this.loginFormBuilder.group({\n      email: [''],\n      password: ['']\n    });\n    this.registerForm = this.registerFormBuilder.group({\n      email: [''],\n      password: [''],\n      nickName: [''],\n      name: [''],\n      surname: [''],\n      role: [''],\n      stick: ['']\n    });\n    this.user = firebaseAuth.authState;\n  }\n  ngOnInit() {\n    if (this.user) {\n      this.router.navigateByUrl('/home');\n    }\n  }\n  openSnackBar(message) {\n    this.snackBar.open(message, 'ok', {\n      duration: 10000\n    });\n  }\n  createUser(uid) {\n    const userData = {\n      ...this.registerForm.value,\n      uid,\n      active: false,\n      password: null\n    };\n    return this.afs.collection('users').doc(this.registerForm.value.email.toLowerCase()).set(userData);\n  }\n  register() {\n    if (this.registerForm.status === 'VALID') {\n      this.firebaseAuth.auth.createUserWithEmailAndPassword(this.registerForm.value.email.toLowerCase(), this.registerForm.value.password).then(value => {\n        console.log(value);\n        this.createUser(value.user.uid).then(res => {\n          this.openSnackBar('Успех');\n          this.router.navigate(['']);\n          console.log(res);\n        });\n      }).catch(err => {\n        this.openSnackBar(err.message);\n      });\n    } else {\n      this.openSnackBar('Не все поля заполнены.');\n    }\n  }\n  login() {\n    if (this.loginForm.status === 'VALID') {\n      this.firebaseAuth.auth.signInWithEmailAndPassword(this.loginForm.value.email, this.loginForm.value.password).then(res => {\n        const usersRef = this.afs.collection('users').doc(this.loginForm.value.email.toLowerCase()).ref;\n        usersRef.get().then(doc => {\n          console.log(res);\n          this.openSnackBar('Успех');\n          this.router.navigateByUrl('/home');\n        }).catch(err => {\n          console.log(err);\n          this.firebaseAuth.auth.signOut().then(response => {\n            console.log(response);\n            this.openSnackBar('Ваш аккаунт находится на валидации.');\n          }).catch(error => {\n            console.log(error);\n            this.openSnackBar('Лшибка сервера.');\n          });\n        });\n      }).catch(err => {\n        this.openSnackBar(err.message);\n      });\n    } else {\n      this.openSnackBar('Не все поля заполнены.');\n    }\n  }\n};\nRegComponent = __decorate([Component({\n  selector: 'app-reg',\n  templateUrl: './reg.component.html',\n  styleUrls: ['./reg.component.scss']\n}), __metadata(\"design:paramtypes\", [Router, typeof (_a = typeof AngularFireAuth !== \"undefined\" && AngularFireAuth) === \"function\" ? _a : Object, typeof (_b = typeof AngularFirestore !== \"undefined\" && AngularFirestore) === \"function\" ? _b : Object, FormBuilder, FormBuilder, MatSnackBar])], RegComponent);\nexport { RegComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}