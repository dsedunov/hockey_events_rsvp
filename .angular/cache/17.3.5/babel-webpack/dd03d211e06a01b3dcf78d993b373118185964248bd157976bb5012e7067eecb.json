{"ast":null,"code":"import _asyncToGenerator from \"/Users/daniilsedunov/Documents/GitHub/hockey_events_rsvp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _a, _b, _c, _d;\nimport { __decorate, __metadata } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { MatSnackBar } from '@angular/material';\nimport { MessagingService } from '../messaging.service';\nimport { VERSION, MatDialog } from '@angular/material';\nimport { FileNameDialogComponent } from '../home/file-name-dialog.component';\n// import { PushNotificationOptions, PushNotificationService } from 'ngx-push-notifications';\nlet HomeComponent = class HomeComponent {\n  openFileDialog(event) {\n    this.fileNameDialogRef = this.dialog.open(FileNameDialogComponent, {\n      data: {\n        event: JSON.stringify(event)\n      }\n    });\n  }\n  constructor(messagingService, firebaseAuth, afs, router, snackBar, dialog\n  // private _pushNotificationService: PushNotificationService,\n  ) {\n    this.messagingService = messagingService;\n    this.firebaseAuth = firebaseAuth;\n    this.afs = afs;\n    this.router = router;\n    this.snackBar = snackBar;\n    this.dialog = dialog;\n    this.toggle = true;\n    this.status = 'Enable';\n    this.user = null;\n    this.version = VERSION;\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      // const isGranted = this._pushNotificationService.isPermissionGranted;\n      // this._pushNotificationService.requestPermission();\n      const usersRef = _this.afs.collection('users').doc(_this.firebaseAuth.auth.currentUser.email.toLowerCase()).ref;\n      yield usersRef.get().then(doc => {\n        if (doc.exists) {\n          _this.user = doc.data();\n          _this.user.uid = _this.firebaseAuth.auth.currentUser.uid;\n          const userId = _this.user.uid;\n          _this.messagingService.requestPermission(userId);\n          _this.messagingService.receiveMessage();\n          _this.message = _this.messagingService.currentMessage;\n        } else {\n          console.log('No such document!');\n        }\n      }).catch(err => {\n        console.log('Error getting document', err);\n      });\n      _this.eventsCollection = _this.afs.collection('events', ref => ref.limit(100).orderBy('gameDay', 'asc'));\n      _this.eventsCollection.snapshotChanges().subscribe(eventsList => {\n        const events = eventsList.map(item => {\n          let whatIAmAnswer = false;\n          const players = item.payload.doc.data().players && item.payload.doc.data().players.reduce((ARplayers, player) => {\n            if (player.uid === _this.user.uid) {\n              whatIAmAnswer = player.status;\n            }\n            ARplayers[player.status].push(player);\n            return ARplayers;\n          }, {\n            accept: [],\n            reject: []\n          }) || {\n            accept: [],\n            reject: []\n          };\n          const {\n            gameDay\n          } = item.payload.doc.data();\n          return {\n            id: item.payload.doc.id,\n            ...item.payload.doc.data(),\n            gameDayISO: gameDay,\n            gameDay: new Date(gameDay).toLocaleString('ru', {\n              month: 'long',\n              day: 'numeric',\n              hour: 'numeric',\n              minute: 'numeric'\n            }),\n            players,\n            whatIAmAnswer\n          };\n        });\n        _this.eventsFuture = events.filter(event => event.gameDayISO > +new Date());\n        _this.eventsPast = events.filter(event => event.gameDayISO < +new Date());\n      });\n    })();\n  }\n  accessInvite(eventId, players, status) {\n    const {\n      name,\n      surname,\n      role\n    } = this.user;\n    const oldPlayers = [...players.accept, ...players.reject];\n    const currUserUid = this.user.uid;\n    const oldRecordId = oldPlayers.findIndex(player => player.uid === currUserUid);\n    if (Number(oldRecordId) + 1) {\n      oldPlayers.splice(oldRecordId, 1);\n    }\n    players = [...oldPlayers, {\n      status,\n      name,\n      surname,\n      role,\n      uid: this.user.uid\n    }];\n    this.afs.collection('events').doc(eventId).update({\n      players\n    }).then(res => {\n      this.snackBar.open(status === 'accept' ? 'Ждём тебя' : 'У тебя есть время передумать', 'ok', {\n        duration: 10000\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n    this.toggle = !this.toggle;\n    this.status = this.toggle ? 'Enable' : 'Disable';\n  }\n  createEvent() {\n    this.router.navigateByUrl('/event');\n  }\n  goToProfile() {\n    this.router.navigateByUrl('/profile');\n  }\n  viewDetails(params) {\n    if (params) {\n      this.router.navigate(['view'], {\n        queryParams: {\n          param: JSON.stringify(params)\n        }\n      });\n    }\n  }\n  copyMessage(playersObj) {\n    const playersString = playersObj.reduce((startStr, player, i) => {\n      return `${startStr}${i ? '\\n' : ''}${player.name} ${player.surname} ${player.color} ${player.number}`;\n    }, '');\n    const selBox = document.createElement('textarea');\n    selBox.style.position = 'fixed';\n    selBox.style.left = '0';\n    selBox.style.top = '0';\n    selBox.style.opacity = '0';\n    selBox.value = playersString;\n    document.body.appendChild(selBox);\n    selBox.focus();\n    selBox.select();\n    document.execCommand('copy');\n    document.body.removeChild(selBox);\n    this.snackBar.open('Скопировано', 'ok', {\n      duration: 10000\n    });\n  }\n  removeEvent(id) {\n    return this.afs.collection('events').doc(id).delete().then(() => {\n      this.snackBar.open('Прощай', 'ok', {\n        duration: 10000\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n};\nHomeComponent = __decorate([Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n}), __metadata(\"design:paramtypes\", [MessagingService, typeof (_a = typeof AngularFireAuth !== \"undefined\" && AngularFireAuth) === \"function\" ? _a : Object, typeof (_b = typeof AngularFirestore !== \"undefined\" && AngularFirestore) === \"function\" ? _b : Object, Router, typeof (_c = typeof MatSnackBar !== \"undefined\" && MatSnackBar) === \"function\" ? _c : Object, typeof (_d = typeof MatDialog !== \"undefined\" && MatDialog) === \"function\" ? _d : Object])], HomeComponent);\nexport { HomeComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}